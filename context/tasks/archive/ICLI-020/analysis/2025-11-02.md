# Analysis Log — ICLI-020 — 2025-11-02

- **Author:** Assistant
- **Lifecycle stage:** Analysis
- **Context:** First pass catalogue of existing packages and exports to prepare the public vs internal API policy.

## Knowledge consulted
- [context/roadmap/execution-architecture-brief.md](/context/roadmap/execution-architecture-brief.md) — Reconfirmed the
  distinction between Essential and Advanced APIs (CommandService vs ProcessEngine) to ground the package
  classification.
- [context/roadmap/execution-use-case-catalogue.md](/context/roadmap/execution-use-case-catalogue.md) — Checked which
  scenario categories depend on Essential vs Advanced APIs so each remains accessible after we tighten exports.
- [README.md](/README.md) — Validated which packages are already documented as public entry points (client +
  StandardProcessEngine) to avoid breaking advertised usage.
- [src/main/java/module-info.java](/src/main/java/module-info.java) — Enumerated the packages currently exported by the
  module and compared them with the architectural expectations.

## Repository inspection
- `src/main/java` — Identified top-level packages:
  - `com.github.ulviar.icli.client` (Essential API) — CommandService, session runners, and client-facing result types.
  - `com.github.ulviar.icli.engine` (Advanced API) — CommandDefinition, ExecutionOptions, ProcessEngine contracts, etc.
  - `com.github.ulviar.icli.engine.runtime` (Advanced API) — home for StandardProcessEngine and runtime exceptions.
  - `com.github.ulviar.icli.engine.diagnostics` — diagnostics entry point published alongside the runtime.
  - `com.github.ulviar.icli.engine.pool.api` and `.api.hooks` (Advanced API) — ProcessPool, WorkerLease, and hook
  interfaces required for pooled scenarios from the catalogue.
  - `com.github.ulviar.icli.engine.runtime.internal` and nested helpers (`io`, `launch`, `shutdown`, `terminal`) —
  implementation details that remain non-exported.
  - `com.github.ulviar.icli.engine.pool.internal.*` — already segregated as internal helpers for the pool runtime.
  - Root package `com.github.ulviar.icli` — hosts package-level annotations only.
- `src/main/java/module-info.java` — Exports `client`, `engine`, `engine.runtime`, `engine.diagnostics`,
  `engine.pool.api`, and `engine.pool.api.hooks`. Internal namespaces such as `engine.runtime.internal` remain
  unexported.

## Gaps & questions
- Decide whether `StandardProcessEngine` should remain publicly accessible from the runtime package or aggregate under a
  higher-level namespace. Hiding the entire runtime package would break README usage unless the class moves.
- Ensure diagnostics types live in a dedicated API package so runtime internals remain hidden while still allowing
  subscribers.
- Confirm no public docs or tests require direct access to `engine.runtime.internal` helpers before restricting exports.

## Decision / readiness
- Ready to proceed with boundary design: next step is to define the public API policy document and propose package moves
  so only the intended types remain exported.

## Next steps
- Capture the public vs internal API narrative (README section for consumers +
  [context/guidelines/icli/public-api.md](/context/guidelines/icli/public-api.md) for maintainers) using the following
  classification:
  - **Essential API (public/long-term):** `com.github.ulviar.icli.client`.
  - **Advanced API (public/long-term):** `com.github.ulviar.icli.engine`, `com.github.ulviar.icli.engine.pool.api`,
  `com.github.ulviar.icli.engine.pool.api.hooks`, new `com.github.ulviar.icli.engine.runtime` (hosting
  `StandardProcessEngine`, `ProcessEngineExecutionException`, `ProcessShutdownException`).
  - **Internal (not exported):** `com.github.ulviar.icli.engine.runtime.internal.*` (hosting launch/session helpers),
  and `com.github.ulviar.icli.engine.pool.internal.*`.
- Sketch export changes for `module-info.java`: ensure only the Essential/Advanced packages above are exported and keep
  `com.github.ulviar.icli.engine.runtime.internal.*` hidden.
