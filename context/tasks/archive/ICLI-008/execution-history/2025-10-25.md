# Execution History — ICLI-008 — 2025-10-25

- **Author:** Assistant
- **Lifecycle stage:** Execution
- **Summary:** Captured the maintainer’s TDD/documentation requirements, rewrote the ProcessEngine specification,
  designed failing tests first, and then introduced a modular pipe-based implementation with focused unit/integration
  coverage.

## Implementation notes
- Updated [context/guidelines/icli/assistant-notes.md](/context/guidelines/icli/assistant-notes.md) with the mandated
  workflow: document-first testing, strict TDD sequencing, and aggressive responsibility separation so future
  contributors inherit the process.
- Expanded `ProcessEngine` Javadoc to spell out preconditions, postconditions, and error semantics, ensuring tests
  derive exclusively from the public contract.
- Followed TDD by (a) authoring new tests (`StandardProcessEngineTest`—initially named
  `PipeProcessEngineTest`—`PipeCommandLauncherTest`, `BoundedOutputSinkTest`, `VirtualThreadStreamDrainerTest`,
  `ShutdownExecutorTest`) and running them to observe the expected compilation failure, then (b) introducing the
  production classes.
- Implemented a fresh runtime composed of small helpers (`PipeCommandLauncher`, `ProcessBuilderStarter`,
  `BoundedOutputSink`/`DiscardOutputSink` + factory, `VirtualThreadStreamDrainer`, `ShutdownExecutor`,
  `TreeAwareProcessTerminator`) orchestrated by the new `StandardProcessEngine` (introduced under the
  `PipeProcessEngine` name). Each helper encapsulates one responsibility and is covered by its own unit test;
  `StandardProcessEngineTest` exercises the documented scenarios end-to-end with the deterministic `TestProcess`.
- Split the once-flat `com.github.ulviar.icli.core` package into purpose-driven namespaces (`core.runtime`,
  `core.runtime.launch`, `core.runtime.io`, `core.runtime.shutdown`) with their own `package-info` declarations and
  thorough Javadoc so internal responsibilities are easy to navigate. `module-info.java` now exports only the top-level
  runtime entry point to keep helper packages internal.
- `ProcessEngine.startSession` remains unsupported and explicitly documented as such; PTY requirements still throw
  `UnsupportedOperationException` until the PTY path lands in a later task.

## Tests & verification
- `./gradlew test` — Passed after the implementation/refactor phase, covering the helper/unit suites plus the
  integration tests.
- `./gradlew test` (earlier runs) — intentionally failed first because only the new tests existed, and later surfaced a
  compilation failure in `PipeCommandLauncherTest` after the package split; both failures were resolved before
  finishing.

## Documentation updates
- [context/guidelines/icli/assistant-notes.md](/context/guidelines/icli/assistant-notes.md) — added “Process
  documentation & TDD discipline” section mirroring the maintainer instructions.
- `src/main/java/com/github/ulviar/icli/core/ProcessEngine.java` — enriched Javadoc describing contracts, supported
  features, and error handling.
- `src/main/java/com/github/ulviar/icli/core/runtime/**` — new package-level docs plus extensive class-level Javadoc for
  every helper component so behaviour is fully specified outside the tests.

## Follow-up & risks
- Streaming captures and PTY-backed launches intentionally throw for now; follow-up work must introduce PTY providers
  and streaming sinks before exposing those ExecutionOptions.
- Diagnostics (event bus, truncation markers) are still absent; once the diagnostics module arrives, extend
  `ProcessResult` accordingly.

## Retrospective & process improvement
- The spec → tests → code workflow met the updated Definition of Done. Future tasks should continue logging the “failing
  test” phase explicitly (e.g., referencing the Gradle failure) to keep the TDD evidence easy to audit.

## Links
- Dossier: [context/tasks/ICLI-008/README.md](../README.md)
