# Analysis Log — ICLI-008 — 2025-10-25

- **Author:** Assistant
- **Lifecycle stage:** Analysis
- **Context:** Establish scope and implementation strategy for the single command executor before writing code.

## Knowledge consulted
- [context/roadmap/project-roadmap.md](/context/roadmap/project-roadmap.md) — Confirmed that Phase 3 prioritises the
  single-run executor immediately after the `CommandSpec` builder, so this task must unblock CommandService wiring
  without waiting for pooling or PTY features.
- [context/roadmap/execution-architecture-brief.md](/context/roadmap/execution-architecture-brief.md) — Clarified
  runtime layering (ProcessLauncher + IOBridge + TimeoutSupervisor) and defaults (64 KiB merged output, 60 s + 5 s
  shutdown plan). This influences class naming, responsibilities, and timeout/capture expectations for the executor
  implementation.
- [context/knowledge-base/operations/Java Terminal & Process
  Integration.md](/context/knowledge-base/operations/Java%20Terminal%20%26%20Process%20Integration.md) — Reiterated the
  need to drain stdout/stderr concurrently, avoid shells unless required, and prepare for future PTY integration. Guides
  the buffer/pump design choices and reinforces the distinction between pipe-based v. PTY launches.

## Repository inspection
- `src/main/java/com/github/ulviar/icli/core/*` — `ProcessEngine`, `CommandDefinition`, `ExecutionOptions`, and
  `ProcessResult` exist as API contracts but have no concrete runtime implementation. This executor must live alongside
  them (likely in `core`) and satisfy `ProcessEngine.run`.
- `src/test/kotlin/com/github/ulviar/icli/*` — Current tests rely on `RecordingExecutionEngine`, meaning no integration
  coverage for real process execution yet. New Kotlin tests will have to spawn lightweight commands (e.g.,
  `["/bin/sh","-c","..."]`) to verify the executor’s behaviour cross-platform.
- `src/main/java/com/github/ulviar/icli/client/CommandService.java` — Consumes `ProcessEngine.run`/`startSession`, so
  the executor must be injectable without forcing CommandService changes.

## Gaps & questions
- Need to finalise package/class naming (e.g., `StandardProcessEngine` — originally drafted as `PipeProcessEngine` —
  versus `SingleRunExecutor`) to align with the architecture brief’s terminology.
- Timeout enforcement strategy: whether to rely on `Process.waitFor(Duration)` loops or explicit supervisors/virtual
  threads is undecided.
- Bounded capture policy needs concrete data structures (e.g., byte ring buffer); decision pending implementation spike.

## Decision / readiness
- Ready to proceed to design/implementation, pending answers to the questions above during execution. No additional
  research blockers identified.

## Next steps
- Design process launch helper(s) for pipe-based execution and layout unit/integration tests that validate
  success/failure/timeouts.
- Prototype bounded output accumulators and concurrent pumps guided by OutputCapture policies.
- Draft a shutdown supervisor that applies the `ShutdownPlan` soft/hard kill sequence.
