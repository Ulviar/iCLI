# Analysis Log — ICLI-015 — 2025-10-28

- **Author:** Assistant
- **Lifecycle stage:** Analysis
- **Context:** Establish the implementation approach for the ProcessPool runtime before beginning TDD.

## Knowledge consulted
- [Process Pool Architecture Specification](../../roadmap/process-pool-architecture.md) — Defines the required
  `ProcessPool`/`WorkerLease` APIs, configuration defaults, scheduling semantics, and shutdown/diagnostics obligations
  that the runtime must satisfy.
- [Execution Architecture Brief](../../roadmap/execution-architecture-brief.md) — Clarifies how the pool plugs into the
  existing runtime (reusing `ProcessEngine.startSession`, `ShutdownExecutor`, diagnostics bus) and the layering between
  advanced and essential APIs.
- [Execution Requirements Brief](../../roadmap/execution-requirements.md) — Reiterates timeout, resource safety, and
  cross-platform expectations that the pool must preserve when recycling interactive sessions.
- [Java Terminal & Process Integration — Knowledge
  Base](../../knowledge-base/operations/Java%20Terminal%20%26%20Process%20Integration.md) — Highlights PTY vs pipe
  handling, shutdown ordering, and stream draining risks that inform worker
  reset hooks and failure policies.

## Repository inspection
- `src/main/java/com/github/ulviar/icli/core/runtime` — Reviewed `StandardProcessEngine`, shutdown executors, and idle
  timeout utilities to confirm available collaborators for launching, terminating, and supervising workers.
- `src/main/java/com/github/ulviar/icli/client` — Examined async scheduler helpers (`ClientScheduler`,
  `ClientSchedulers`)
  to understand how `ProcessPool.acquireAsync` should delegate.
- `build.gradle.kts` and `module-info.java` — Confirmed module exports and source set structure; noted that a new
  `com.github.ulviar.icli.core.pool` package and Kotlin test sources will need to be added explicitly.

## Gaps & questions
- Need deterministic fakes for `InteractiveSession`, `ShutdownExecutor`, and time sources to exercise queueing and
  eviction without launching real processes.
- Confirm where default reset hooks should live (pool package vs runtime package) and how to surface them for tests.
- Decide on concurrency primitives (virtual-thread friendly) that align with repository preferences; await confirmation
  during design of the initial tests.

## Decision / readiness
- Execution can begin once test fixtures for fake sessions and clock/scheduler overrides are drafted in Kotlin to drive
  TDD scenarios.

## Next steps
- Sketch Kotlin unit tests that describe lease acquisition/timeout behaviour using fake workers and clocks.
- Model configuration defaults in code and assert they mirror the architecture spec.
- Implement pool internals iteratively, ensuring diagnostics and shutdown hooks are wired per spec.
