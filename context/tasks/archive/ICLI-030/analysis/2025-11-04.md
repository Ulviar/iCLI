# Analysis Log — ICLI-030 — 2025-11-04

- **Author:** Assistant
- **Lifecycle stage:** Analysis
- **Context:** Establish the concrete cleanup scope for the pooled client migration before touching code.

## Knowledge consulted
- [context/tasks/backlog.md](/context/tasks/backlog.md) — Clarified the Definition of Done: finish the pooled API
  migration by repositioning `ProcessPoolClient`, tightening diagnostics wiring, and adding consumer guidance.
- [context/tasks/archive/ICLI-026/design/2025-11-03-pooled-command-service.md](../../ICLI-026/design/2025-11-03-pooled-command-service.md)
  — Detailed the planned three-phase rollout and explicitly called out ICLI-030 deliverables (move
  `ProcessPoolClient`/`Service*` types under `client.pooled`, deprecate legacy factories, update docs).
- [context/roadmap/process-pool-architecture.md](/context/roadmap/process-pool-architecture.md) — Reconfirmed the
  advanced/Essential split so the migration keeps `ProcessPoolClient` in the advanced lane without regressing pool
  contracts.

## Repository inspection
- `src/main/java/com/github/ulviar/icli/client/CommandService.java` — Verified the class now exposes `pooled()`
  returning `PooledCommandService`, so cleanup focuses on package and documentation alignment rather than API changes.
- `src/main/java/com/github/ulviar/icli/client/pooled/PooledCommandService.java` — Observed that pooled helpers still
  import `ProcessPoolClient` and listener types from the root `client` package; moving those collaborators will cascade
  through this file and pooled runners.
- `src/main/java/com/github/ulviar/icli/client/ProcessPoolClient.java`, `ServiceProcessor.java`,
  `ServiceConversation.java`, `ServiceProcessorListener.java` — Confirmed they remain under
  `com.github.ulviar.icli.client`, are exported via JPMS, and own the diagnostics hooks that must follow the relocation.
- `src/main/java/module-info.java` — Already exports both `client` and `client.pooled`, so moving classes requires
  updating the exports and ensuring advanced types remain reachable.
- Kotlin tests under `src/test/kotlin/com/github/ulviar/icli/client/**` — Located suites for `ProcessPoolClient`,
  `ServiceProcessor`, and `ServiceConversation` that will need package updates plus any new migration coverage.

## Gaps & questions
- Need confirmation on whether `CommandService.pooled()` should be renamed (e.g., `pooledService()`) or simply
  documented now that it returns the new facade; backlog wording implies deprecated overloads existed, but repository
  state already removed them.
- Determine where migration guidance should live: README, roadmap brief, and/or dedicated docs section?

## Decision / readiness
Execution can begin. Remaining ambiguities (method rename, documentation placement) can be resolved during
implementation because they do not block prototyping.

## Next steps
- Move `ProcessPoolClient`, `ServiceProcessor`, `ServiceConversation`, and `ServiceProcessorListener` into
  `com.github.ulviar.icli.client.pooled` (adjusting JPMS exports and package-info files) while keeping
  backwards-compatible public contracts.
- Update pooled helpers, specs, and Kotlin tests to import the relocated types and ensure diagnostics wiring remains
  intact.
- Refresh documentation (README, roadmap/design references, task dossier) with migration guidance and clarify the
  Essential vs advanced pooled entry points.
