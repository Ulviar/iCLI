# Analysis Log — ICLI-014 — 2025-10-28

- **Author:** Assistant
- **Lifecycle stage:** Analysis
- **Context:** Baseline review of requirements and existing runtime pieces before drafting the worker pool design.

## Knowledge consulted
- [Repository agent guidelines](../../AGENTS.md) — Reinforced tooling and workflow rules that shape deliverables and
  verification steps.
- [Execution architecture brief](../../roadmap/execution-architecture-brief.md) — Clarified expected API tiers
  (ProcessPoolClient, WorkerPool, WorkerLease) and default sizing/retry policies that the design must formalise.
- [Execution requirements brief](../../roadmap/execution-requirements.md) — Captured pooling constraints around
  isolation, timeouts, diagnostics, and platform parity that the pool must uphold.
- [Execution use case catalogue](../../roadmap/execution-use-case-catalogue.md) — Highlighted scenarios (long-lived
  automation, heterogeneous command reuse) to ensure the pool handles state reset and eviction.
- [Java Terminal & Process Integration
  KB](../../knowledge-base/operations/Java%20Terminal%20%26%20Process%20Integration.md)
  — Provided operational expectations for PTY, signal handling, and IO pumping that pool workers inherit.
- [Kotlin legacy solution audit](../../research/experiments/kotlin-solution-audit.md) — Surfaced pitfalls from the
  prior pooling approach (busy loops, hardcoded commands, lax recycling) to avoid in the new design.
- [Execution engine benchmarks](../../research/icli-execution-engine-benchmarks.md) — Emphasised industry lessons on
  state isolation, transcript logging, and cautious pooling applicability.

## Repository inspection
- `src/main/java/com/github/ulviar/icli/core/runtime/StandardProcessEngine.java` — Reviewed launch/shutdown flow to
  understand how pooled workers should reuse existing shutdown executors and stream draining.
- `src/main/java/com/github/ulviar/icli/core/InteractiveSession.java` — Confirmed session capabilities (signals, idle
  timeout, onExit future) that WorkerLease must expose.
- `src/main/java/com/github/ulviar/icli/core/ExecutionOptions.java` — Noted defaults and builder semantics the pool
  should reuse per backlog constraint.
- `src/main/java/com/github/ulviar/icli/client` package — Assessed CommandService/ClientScheduler patterns to ensure
  ProcessPoolClient integrates cleanly with async helpers delivered in ICLI-012.

## Gaps & questions
- Define which diagnostics bus events the pool should emit (lease acquisition, reset failures, worker eviction).
- Determine safe heuristics for heterogeneous command routing without reintroducing state bleed between different
  request shapes.
- Decide whether pool warmers/reset hooks run synchronously on the lease thread or via dedicated virtual tasks.

## Decision / readiness
- Ready to author the architecture specification; outstanding questions will be captured as design decisions or
  follow-ups in the spec.

## Next steps
- Draft ProcessPool/WorkerLease architecture covering configuration, lifecycle, and failure handling.
- Document diagnostics and metrics hooks plus unresolved questions that need future tasks.
