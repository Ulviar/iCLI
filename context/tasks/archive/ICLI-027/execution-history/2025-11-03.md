# Execution History — ICLI-027 — 2025-11-03

- **Author:** Assistant
- **Lifecycle stage:** Execution
- **Summary:** Extracted shared runner helpers, refactored existing runners to use them, and added regression tests
  validating the new structure.

## Implementation notes
- Introduced `client.internal.runner` helpers (`RunnerDefaults`, `CommandCallFactory`, `SessionLauncher`,
  `LineSessionFactory`, plus `package-info.java`) to encapsulate shared runner construction
  (`src/main/java/com/github/ulviar/icli/client/internal/runner/*`).
- Updated `CommandRunner`, `LineSessionRunner`, `InteractiveSessionRunner`, and `CommandService` to depend on the shared
  helpers; adjusted `InteractiveSessionStarter` to implement `SessionLauncher`, centralised PTY fallback sequencing, and
  made `LineSessionClient.create` public for cross-package reuse (`src/main/java/com/github/ulviar/icli/client/*.java`).

## Tests & verification
- `gradle spotlessApply` — Passed (MCP `execute_gradle_task`).
- `gradle spotbugsMain` — Passed after suppressing intentional exposures for `ProcessInteractiveSession`.
- `gradle test` — Passed (MCP `run_gradle_tests`, exercises existing suite along with expanded PTY fallback coverage in
  `RunnerSharedCoreTest`).

## Documentation updates
- None required beyond the task dossier/planning notes.

## Follow-up & risks
- No new risks identified; pooled runner work (ICLI-028) can consume the shared helpers next.

## Retrospective & process improvement
- Definition of Done items satisfied (shared helpers in place, runners refactored, regression coverage added). Workflow
  suggestion: consider expanding helper tests when pooled scenarios add additional behaviours; otherwise no changes.

## Links
- [RunnerSharedCoreTest](../../../../src/test/kotlin/com/github/ulviar/icli/client/RunnerSharedCoreTest.kt)
