# Analysis Log — ICLI-007 — 2025-10-26

- **Author:** Assistant (Codex)
- **Lifecycle stage:** Analysis
- **Context:** Establish background for the blocking vs non-blocking client API decision before drafting the design update.

## Knowledge consulted
- [Project roadmap](../../roadmap/project-roadmap.md) — Highlights that the only outstanding Phase 2 discovery item is deciding on synchronous vs asynchronous client support, confirming urgency and framing the acceptance target.
- [Execution architecture brief](../../roadmap/execution-architecture-brief.md) — Describes Essential vs Advanced API layers and mentions optional Flow-style adapters; clarifies where the modality decision must slot in (CommandService, InteractiveSession, and pool facades).
- [Execution requirements brief](../../roadmap/execution-requirements.md) — Emphasises simultaneous needs for blocking results and incremental streaming plus external cancellation hooks, guiding the criteria the decision must satisfy.
- [Execution use case catalogue](../../roadmap/execution-use-case-catalogue.md) — Surfaces concrete scenarios (REPL automation, long-running pools) that require both completion futures and immediate responses, helping prioritise async ergonomics.
- [iCLI execution engine benchmarks](../../research/icli-execution-engine-benchmarks.md) — Provides comparative patterns (NuProcess callbacks vs PTY-heavy libraries) illustrating trade-offs between low-thread async designs and PTY support, informing the shortlist of strategies.
- [Kotlin legacy solution audit](../../research/experiments/kotlin-solution-audit.md) — Documents lack of streaming handles and mandatory blocking flows in the legacy tool, reinforcing the need to formalise async support to avoid repeating past bottlenecks.

## Repository inspection
- Design documentation under `context/roadmap/` and research notes under `context/research/` reviewed to map current API expectations; no source code changes inspected yet because the task is design-focused.

## Gaps & questions
- Need clarity on Kotlin coroutine expectations for Essential APIs (are extension `suspend` helpers required, or will CompletableFuture adapters suffice?).
- Must define cancellation semantics for async flows (inherit from timeout supervisor or expose dedicated cancellation tokens?).
- Determine how pool clients expose async variants without duplicating logic (shared interface vs separate methods).

## Decision / readiness
- Ready to proceed with drafting the modality decision; no blocking research required beyond the gathered sources.

## Next steps
1. Evaluate candidate async strategies (virtual-thread blocking default, CompletableFuture wrappers, Flow/Channel adapters) against requirements.
2. Capture the decision and rationale in EXPLANATION.md plus update the architecture brief.
3. Note any follow-up implementation tasks (e.g., Kotlin coroutine extensions) in backlog or dossier.
