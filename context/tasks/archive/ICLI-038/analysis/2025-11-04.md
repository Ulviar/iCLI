# Analysis Log — ICLI-038 — 2025-11-04

- **Author:** Assistant (Codex)
- **Lifecycle stage:** Analysis
- **Context:** Define the architecture for the single-run scenario harness before implementing adapters and fixtures.

## Knowledge consulted
- [ICLI-036 plan](../ICLI-036/README.md) — Confirms scenario expectations (Java+Kotlin parity, `java -version` baseline,
  two tests per scenario) that the harness must enable.
- [samples/AGENTS.md](../../../../samples/AGENTS.md) — Provides module-specific workflow rules; must stay aligned after
  updating the harness and documentation.
- [samples/README.md](../../../../samples/README.md) — Starting doc that needs a new section for the harness.
- [build.gradle.kts (samples)](../../../../samples/build.gradle.kts) — Verifies dependencies (Commons Exec, zt-exec,
  NuProcess, JLine) are already available for adapter implementation.
- `src/main/java/com/github/ulviar/icli` (core library) — Inspected `CommandDefinition`, `ExecutionOptions`, and
  `StandardProcessEngine` usage to integrate iCLI into the harness cleanly.

## Repository inspection
- Confirmed `samples` currently only contains metadata classes; new packages (`scenarios.*`, `fixtures`, `support`) will
  be added alongside fresh `package-info` files for `@NotNullByDefault` compliance.
- Verified there are no existing fake process fixtures; a dedicated helper plus Java/Kotlin builders are required.

## Gaps & questions
- Need to ensure NuProcess and JLine adapters expose consistent timeout/diagnostic behaviour despite API differences.
- Determine how to expose combined stdout/stderr for libraries that inherently merge streams (JLine/ExecHelper).

## Decision / readiness
- Ready to implement the harness, adapters, fixtures, and documentation updates.

## Next steps
- Add core scenario types + package annotations under `com.github.ulviar.icli.samples.scenarios.single`.
- Implement adapters for iCLI, Commons Exec, zt-exec, NuProcess, and JLine plus Kotlin helper accessors.
- Create fake-process CLI + invocation builders (fake + `java -version`) and accompanying Kotlin tests covering every
  adapter.
- Update samples documentation to describe the harness and contribution workflow.
